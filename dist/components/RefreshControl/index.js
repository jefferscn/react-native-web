Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _jsxFileName='src/components/RefreshControl/index.js';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _ColorPropType=require('../../propTypes/ColorPropType');var _ColorPropType2=_interopRequireDefault(_ColorPropType);var _View=require('../View');var _View2=_interopRequireDefault(_View);var _RefreshIndicator=require('./RefreshIndicator');var _RefreshIndicator2=_interopRequireDefault(_RefreshIndicator);var _ViewPropTypes=require('../View/ViewPropTypes');var _ViewPropTypes2=_interopRequireDefault(_ViewPropTypes);var _propTypes=require('prop-types');var _react=require('react');var _react2=_interopRequireDefault(_react);var _BokePan=require('./BokePan/');var _BokePan2=_interopRequireDefault(_BokePan);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var style={refresh:{display:'inline-block',marginLeft:'50%'}};var distanceToRefresh=50;var resistance=2.5;var RefreshControl=function(_Component){_inherits(RefreshControl,_Component);function RefreshControl(props){_classCallCheck(this,RefreshControl);var _this=_possibleConstructorReturn(this,(RefreshControl.__proto__||Object.getPrototypeOf(RefreshControl)).call(this,props));_this.handlePanDown=function(event){var distance=event.distance;distance=distance/resistance;var progressViewOffset=_this.props.progressViewOffset;if(_this.isStatusLoading()){return;}var percentage=distance/distanceToRefresh*100;if(percentage>100){percentage=100+(percentage-100)/4;}percentage=parseInt(percentage,10);var top=progressViewOffset+distance;_this.setState({status:'ready',scrolling:true,top:top,percentage:percentage,panningDown:true});};_this.isStatusLoading=function(){var status=_this.state.status;return status==='loading';};_this.handlePanUp=function(event){if(event.current[1]-event.origin[1]<=0){_this.setState({percentage:0});return;}if(_this.state.panningDown){_this.handlePanDown(event);}};_this._doReset=function(){_this.setState({status:'hide',panningDown:false});};_this._doLoading=function(){var _this$props=_this.props,onRefresh=_this$props.onRefresh,progressViewOffset=_this$props.progressViewOffset;if(!onRefresh){return _this._doReset();}_this.setState({status:'loading',top:progressViewOffset});setTimeout(function(){onRefresh().then(_this._doReset);},1000);};_this.handlePanEnd=function(event){if(event.current[1]-event.origin[1]<=0){_this._doReset();return;}var distance=event.distance;distance=distance/resistance;if(_this.isStatusLoading()||!_this.state.panningDown){return;}var canRefresh=false;if(distance>distanceToRefresh){canRefresh=true;}if(canRefresh){_this._doLoading();}else{_this._doReset();}};_this.state={initialized:false,percentage:0,top:-40,status:'hide',panningDown:false};return _this;}_createClass(RefreshControl,[{key:'render',value:function render(){var _props=this.props,colors=_props.colors,enabled=_props.enabled,onRefresh=_props.onRefresh,progressBackgroundColor=_props.progressBackgroundColor,progressViewOffset=_props.progressViewOffset,refreshing=_props.refreshing,size=_props.size,tintColor=_props.tintColor,title=_props.title,titleColor=_props.titleColor,rest=_objectWithoutProperties(_props,['colors','enabled','onRefresh','progressBackgroundColor','progressViewOffset','refreshing','size','tintColor','title','titleColor']);var _state=this.state,percentage=_state.percentage,top=_state.top,status=_state.status;return _react2.default.createElement(_BokePan2.default,{onPanDown:this.handlePanDown,onPanEnd:this.handlePanEnd,onPanUp:this.handlePanUp,__source:{fileName:_jsxFileName,lineNumber:157}},_react2.default.createElement(_View2.default,_extends({},rest,{style:[this.props.style],__source:{fileName:_jsxFileName,lineNumber:162}}),_react2.default.createElement(_RefreshIndicator2.default,{left:-size/2||-20,percentage:percentage,size:size||40,status:status,style:_extends({},style.refresh),top:top,__source:{fileName:_jsxFileName,lineNumber:166}}),_react2.default.createElement(_View2.default,{style:{flex:1},__source:{fileName:_jsxFileName,lineNumber:176}},_react2.default.createElement(_View2.default,_extends({},rest,{style:{flex:1},__source:{fileName:_jsxFileName,lineNumber:181}})))));}}]);return RefreshControl;}(_react.Component);RefreshControl.propTypes=process.env.NODE_ENV!=="production"?_extends({},_ViewPropTypes2.default,{colors:(0,_propTypes.arrayOf)(_ColorPropType2.default),enabled:_propTypes.bool,onRefresh:_propTypes.func,progressBackgroundColor:_ColorPropType2.default,progressViewOffset:_propTypes.number,refreshing:_propTypes.bool.isRequired,size:(0,_propTypes.oneOf)([0,1]),tintColor:_ColorPropType2.default,title:_propTypes.string,titleColor:_ColorPropType2.default}):{};exports.default=RefreshControl;